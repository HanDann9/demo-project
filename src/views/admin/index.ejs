<section style="background-color: #eee;">
  <div class="container py-5">
    <div class="row d-flex justify-content-center">
      <div class="col-md-8 col-lg-6 col-xl-6">
        <div class="card" id="chat2">
          <div class="card-header d-flex justify-content-between align-items-center p-3 bg-info text-white border-bottom-0 rounded-3">
            <i class="fas fa-angle-left"></i>
            <p class="mb-0 fw-bold">User</p>
            <i class="fas fa-times"></i>
          </div>
          <div class="card-body overflow-auto" data-mdb-perfect-scrollbar="true" id="chat" style="height: 500px;"> </div>
          <form class="card-footer text-muted d-flex justify-content-start align-items-center p-3 rounded-3">
            <img class="rounded-circle me-2" src="https://i.pinimg.com/564x/03/26/26/032626472f09ce0e02132a769cc2e559.jpg" alt="avatar 3" style="width: 35px; height: 100%;">
            <input type="text" class="form-control form-control-lg" id="messageInput" placeholder="Type message">
            <button class="ms-2 rounded-circle" type="submit"><i class="fas fa-paper-plane"></i></button>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  const socket = new WebSocket(`ws://localhost:3000`);
  const chatDiv = document.getElementById('chat');
  const form = document.querySelector('form');

  // When the WebSocket connection is established
  socket.addEventListener('open', () => {
    console.log('Connected to server');
  });

  // When a message is received from the server
  socket.addEventListener('message', event => {
    const message = event.data;
    const lastChat = $('#chat > div:last');

    if (lastChat.attr('id') === 'receiver') {
      $('#message-receiver').append(`<p class="small p-2 ms-3 mb-1 rounded-3" style="background-color: #f5f6f7;">${message}</p>`);
    } else {
      const messageHTML = `
        <div class="d-flex flex-row justify-content-start" id="receiver">
          <img class="rounded-circle" src="https://i.pinimg.com/564x/f0/a3/44/f0a344551001f7ed0f3022c3abae2560.jpg" alt="avatar 1" style="width: 40px; height: 100%;">
          <div id="message-receiver">
            <p class="small p-2 ms-3 mb-1 rounded-3" style="background-color: #f5f6f7;">${message}</p>
          </div>
        </div>
      `;
      chatDiv.innerHTML += messageHTML;
    }

    // Scroll to the bottom of the chat
    chatDiv.scrollTop = chatDiv.scrollHeight;
  });

  // When the form is submitted
  form.addEventListener('submit', event => {
    event.preventDefault();

    // Get the message from the input field
    const input = document.getElementById('messageInput');
    const message = input.value;

    // Render the message on the page
    const lastChat = $('#chat > div:last');
    if (lastChat.attr('id') !== 'sender') {
      const messageHTML = `
        <div class="d-flex flex-row justify-content-end mb-4 pt-1" id="sender">
          <div id="message-sender">
            <p class="small p-2 me-3 mb-1 text-white rounded-3 bg-primary">${message}</p>
          </div>
          <img class="rounded-circle" src="https://i.pinimg.com/564x/03/26/26/032626472f09ce0e02132a769cc2e559.jpg" alt="avatar 3" style="width: 40px; height: 100%;">
        </div>
      `;
      chatDiv.innerHTML += messageHTML;
    } else {
      $('#message-sender').append(`<p class="small p-2 me-3 mb-1 text-white rounded-3 bg-primary">${message}</p>`);
    }

    // Clear the input field and send the message to the server
    form.reset();
    socket.send(message);

    // Scroll to the bottom of the chat
    chatDiv.scrollTop = chatDiv.scrollHeight;
  });
</script>